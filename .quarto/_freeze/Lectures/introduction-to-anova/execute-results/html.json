{
  "hash": "d26c5754454245ee8df57cd9afaaba73",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Introduction to ANOVA\"\nauthor: \"Dr. Joshua Lambert\"\nformat:\n  html:\n    toc: true\n    toc-title: \"Table of Contents\"\n    code-fold: false\n    code-tools: true\n    css: ../styles.css\n    width: \"99%\"\n---\n\n[**Download R Code for this Lecture**](code/introduction-to-anova.R){ .btn .btn-primary }\n\n\n\n# Understanding Hypothesis Testing and ANOVA\n\n## Constructing a Written and Mathematical Hypothesis\n\nWhen constructing a hypothesis for ANOVA, it's important to formulate it both in a written and mathematical format.\n\n-   **Written Hypothesis (Example 1):**\n    -   Null Hypothesis (Hâ‚€): The average stress in cardiac patients is not different between a placebo group and a behavioral intervention group.\n    -   Alternative Hypothesis (Hâ‚): The average stress in cardiac patients differs between the placebo and behavioral intervention groups.\n-   **Mathematical Hypothesis (Example 1):** $$ H_{0}: \\mu_{placebo} = \\mu_{behavior}$$\n\n$$H_{1}: \\mu_{placebo} \\neq \\mu_{behavior}$$\n\n> **ðŸ’¡ R Tip**: In R, we test these hypotheses using the `aov()` function (analysis of variance). The formula notation `outcome ~ group` means \"outcome explained by group\".\n\n## T-test vs. ANOVA\n\nWhen comparing means between two groups, the t-test and ANOVA will yield the same results. However, ANOVA extends to cases with more than two groups.\n\n> **ðŸ’¡ R Tip**: For two groups, you can use either `t.test()` or `aov()` in R. For three or more groups, you must use ANOVA.\n\n## Writing ANOVA Hypothesis, Type 1 and 2 Errors\n\nIn ANOVA, the hypotheses are:\n\n-   Null Hypothesis (Hâ‚€): All group means are equal.\n-   Alternative Hypothesis (Hâ‚): At least one group mean is different.\n\nType 1 Error: Rejecting the null hypothesis when it is true (false positive).  \nType 2 Error: Failing to reject the null hypothesis when it is false (false negative).\n\n## Assumptions of ANOVA\n\n1.  The dependent variable is measured on an interval or ratio scale.\n2.  The independent variable is categorical.\n3.  Random sampling.\n4.  Normality of Errors\n    - The population errors should be normally distributed. We check this by looking at a histogram or Q-Q plot of the model residuals.\n5.  Homogeneity of population variance.\n\n> **ðŸ’¡ R Tip**: You can check ANOVA assumptions in R (for more detail on assumption checking, see the [Preliminaries](preliminaries.qmd#taking-your-data-on-a-date-exploratory-data-analysis) lecture):\n> - **Normality**: `shapiro.test()` on residuals or Q-Q plot\n> - **Homogeneity of variance**: `leveneTest()` from the car package\n> - **Visual checks**: Residual plots using `plot(model)`\n\n<iframe src=\"http://modeling.nursing.uc.edu/anova_app_2/\" width=\"100%\" height=\"1000px\">\n\n</iframe>\n\n## Visualizing Using Boxplots\n\nBoxplots are essential for visualizing data distribution across groups in ANOVA.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example boxplot in R\ndata <- data.frame(\n    group = rep(c(\"Placebo\", \"Behavioral\", \"Drug\"), each = 10),\n    stress = c(rnorm(10, 5, 1), rnorm(10, 7, 1), rnorm(10, 6, 1))\n)\n\n# Basic boxplot\nboxplot(stress ~ group,\n    data = data,\n    main = \"Boxplot of Stress Scores\",\n    xlab = \"Group\",\n    ylab = \"Stress Score\",\n    col = c(\"lightblue\", \"lightgreen\", \"lightcoral\")\n)\n\n# Add individual points\nstripchart(stress ~ group,\n    data = data,\n    vertical = TRUE,\n    method = \"jitter\",\n    add = TRUE,\n    pch = 19,\n    col = \"darkgray\"\n)\n```\n:::\n\n\n> **ðŸ’¡ R Tip**: The formula `stress ~ group` means \"stress by group\". The `~` symbol separates the dependent variable (left) from the independent variable (right).\n\n## Calculating Variation and Degrees of Freedom\n\n1.  **Sum of Squares Between (SSB):** Variation between groups.\n2.  **Sum of Squares Within (SSW):** Variation within groups.\n3.  **Total Sum of Squares (SST):** Total variation.\n\n-   **Degrees of Freedom:**\n    -   $$df_{between} = k - 1$$ (where k is the number of groups)\n    -   $$df_{within} = N - k$$ (where N is the total sample size)\n\n## The F Statistic and P-Value\n\nThe F statistic is calculated using the ratio of mean squares:\n\n$$\nF = \\frac{MSB}{MSW}\n$$ \n\n- MSB: Mean Square Between \n- MSW: Mean Square Within\n\nThe p-value is derived from the F distribution, given the degrees of freedom.\n\nThe F-distribution is a continuous probability distribution that arises frequently as the null distribution of test statistics, particularly in analysis of variance (ANOVA). It is characterized by two parameters: the degrees of freedom of the numerator (df_between) and the degrees of freedom of the denominator (df_within).\n\n<iframe src=\"http://modeling.nursing.uc.edu/anova_app_1/\" width=\"100%\" height=\"600px\">\n\n</iframe>\n\n## Conducting ANOVA in R\n\n### Basic ANOVA\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit ANOVA model\nmodel <- aov(stress ~ group, data = data)\n\n# View results\nsummary(model)\n\n# The output shows:\n# - Df: Degrees of freedom\n# - Sum Sq: Sum of squares\n# - Mean Sq: Mean squares\n# - F value: F statistic\n# - Pr(>F): P-value\n```\n:::\n\n\n> **ðŸ’¡ R Tip**: The `summary()` function on an `aov` object gives you the ANOVA table. Look for the `Pr(>F)` column for the p-value.\n\n### Extracting Specific Values\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extract F-statistic\nf_stat <- summary(model)[[1]]$`F value`[1]\n\n# Extract p-value\np_value <- summary(model)[[1]]$`Pr(>F)`[1]\n\n# Print results\ncat(\"F-statistic:\", f_stat, \"\\n\")\ncat(\"P-value:\", p_value, \"\\n\")\n```\n:::\n\n\n### Checking Assumptions\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check normality of residuals\nshapiro.test(residuals(model))\n\n# Q-Q plot for normality\nqqnorm(residuals(model))\nqqline(residuals(model), col = \"red\")\n\n# Check homogeneity of variance (requires car package)\nlibrary(car)\nleveneTest(stress ~ group, data = data)\n\n# Diagnostic plots\npar(mfrow = c(2, 2))\nplot(model)\npar(mfrow = c(1, 1))\n```\n:::\n\n\n## Post-hoc Analysis\n\nPost-hoc analysis is essential in ANOVA to identify specific group differences following the detection of a significant F-statistic. This analysis involves comparing all possible pairs of group means to determine which differences are statistically significant.\n\n### The Problem of Multiple Comparisons\n\nWhen we conduct multiple statistical tests simultaneously, the probability of making at least one **Type I error** (a false positive) increases. This is known as **Alpha Inflation** or the **Family-Wise Error Rate (FWER)**.\n\nIf you conduct one test at $\\alpha = 0.05$, there is a 5% chance of a false positive. However, if you compare 3 groups, you have 3 possible pairwise comparisons. The probability of making *at least one* error is:\n$$1 - (1 - 0.05)^3 \\approx 0.14 \\text{ or 14%}$$\n\nTo protect against this, we must use one of two strategies:\n\n1.  **Adjust the Alpha ($\\alpha$):** Lower the threshold for significance for each individual test (e.g., the Bonferroni method uses $\\alpha / \\text{number of tests}$).\n2.  **Adjust the P-values:** Keep the $\\alpha$ at 0.05 but \"penalize\" the p-values by making them larger based on the number of comparisons.\n\n### Tukey HSD vs Bonferroni\n\nTukey's Honestly Significant Difference (HSD) test and the Bonferroni correction are both methods used to manage these multiple comparisons. \n\n- **Tukey's HSD**: Specifically designed for pairwise comparisons of all group means. It adjusts the p-values and confidence intervals to maintain the family-wise error rate at exactly 0.05.\n- **Bonferroni Correction**: The most conservative method. It simply divides your overall alpha (0.05) by the number of comparisons. For 3 comparisons, you would only call a result significant if $p < 0.0167$.\n\n<iframe src=\"http://modeling.nursing.uc.edu/anova_app_3/\" width=\"100%\" height=\"850px\">\n\n</iframe>\n\n### Tukey HSD in R\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Tukey HSD post-hoc test\ntukey_result <- TukeyHSD(model)\nprint(tukey_result)\n\n# Plot the results\nplot(tukey_result)\n\n# The output shows:\n# - diff: Difference in means\n# - lwr, upr: 95% confidence interval\n# - p adj: Adjusted p-value\n```\n:::\n\n\n> **ðŸ’¡ R Tip**: If the confidence interval for a pairwise comparison does not include 0, the difference is statistically significant at the 0.05 level.\n\n### Pairwise t-tests with Bonferroni Correction\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Pairwise t-tests with Bonferroni adjustment\npairwise.t.test(data$stress, data$group, p.adjust.method = \"bonferroni\")\n```\n:::\n\n\n## Comprehensive Example: Complete ANOVA Workflow\n\nLet's work through a complete ANOVA analysis from start to finish:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ============================================\n# Complete ANOVA Example\n# Research Question: Does treatment type affect pain reduction?\n# ============================================\n\n# Step 1: Load required packages\nlibrary(car) # For Levene's test\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'car' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: carData\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'carData' was built under R version 4.5.2\n```\n\n\n:::\n\n```{.r .cell-code}\n# Step 2: Create or read data\nset.seed(456)\npain_data <- data.frame(\n    patient_id = 1:60,\n    treatment = rep(c(\"Standard\", \"Physical Therapy\", \"Medication\"), each = 20),\n    pain_reduction = c(\n        rnorm(20, mean = 2.5, sd = 1.2), # Standard\n        rnorm(20, mean = 4.2, sd = 1.3), # Physical Therapy\n        rnorm(20, mean = 3.8, sd = 1.1) # Medication\n    )\n)\n\n# Convert treatment to factor\npain_data$treatment <- factor(pain_data$treatment)\n\n# Step 3: Explore the data\ncat(\"=== Data Summary ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n=== Data Summary ===\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(pain_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   patient_id               treatment  pain_reduction \n Min.   : 1.00   Medication      :20   Min.   :0.771  \n 1st Qu.:15.75   Physical Therapy:20   1st Qu.:3.232  \n Median :30.50   Standard        :20   Median :3.771  \n Mean   :30.50                         Mean   :3.713  \n 3rd Qu.:45.25                         3rd Qu.:4.473  \n Max.   :60.00                         Max.   :6.560  \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"\\n=== Sample Sizes ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=== Sample Sizes ===\n```\n\n\n:::\n\n```{.r .cell-code}\ntable(pain_data$treatment)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n      Medication Physical Therapy         Standard \n              20               20               20 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"\\n=== Descriptive Statistics by Group ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=== Descriptive Statistics by Group ===\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Means:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMeans:\n```\n\n\n:::\n\n```{.r .cell-code}\ntapply(pain_data$pain_reduction, pain_data$treatment, mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Medication Physical Therapy         Standard \n        4.173282         3.887299         3.079626 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"\\nStandard Deviations:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nStandard Deviations:\n```\n\n\n:::\n\n```{.r .cell-code}\ntapply(pain_data$pain_reduction, pain_data$treatment, sd)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Medication Physical Therapy         Standard \n       0.8110086        1.2574151        1.3892073 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Step 4: Visualize the data\npar(mfrow = c(1, 2))\n\n# Boxplot\nboxplot(pain_reduction ~ treatment,\n    data = pain_data,\n    main = \"Pain Reduction by Treatment\",\n    xlab = \"Treatment\",\n    ylab = \"Pain Reduction (points)\",\n    col = c(\"lightblue\", \"lightgreen\", \"lightcoral\")\n)\n\n# Add points\nstripchart(pain_reduction ~ treatment,\n    data = pain_data,\n    vertical = TRUE,\n    method = \"jitter\",\n    add = TRUE,\n    pch = 19,\n    col = \"darkgray\"\n)\n\n# Histogram of all data\nhist(pain_data$pain_reduction,\n    main = \"Distribution of Pain Reduction\",\n    xlab = \"Pain Reduction (points)\",\n    col = \"lightblue\",\n    border = \"white\"\n)\n```\n\n::: {.cell-output-display}\n![](introduction-to-anova_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\npar(mfrow = c(1, 1))\n\n# Step 5: Check assumptions\ncat(\"\\n=== Assumption Checks ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=== Assumption Checks ===\n```\n\n\n:::\n\n```{.r .cell-code}\n# Normality (overall)\ncat(\"\\nShapiro-Wilk Test for Normality:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nShapiro-Wilk Test for Normality:\n```\n\n\n:::\n\n```{.r .cell-code}\nshapiro_test <- shapiro.test(pain_data$pain_reduction)\nprint(shapiro_test)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  pain_data$pain_reduction\nW = 0.96426, p-value = 0.07616\n```\n\n\n:::\n\n```{.r .cell-code}\n# Homogeneity of variance\ncat(\"\\nLevene's Test for Homogeneity of Variance:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nLevene's Test for Homogeneity of Variance:\n```\n\n\n:::\n\n```{.r .cell-code}\nlevene_test <- leveneTest(pain_reduction ~ treatment, data = pain_data)\nprint(levene_test)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLevene's Test for Homogeneity of Variance (center = median)\n      Df F value Pr(>F)\ngroup  2   2.134 0.1277\n      57               \n```\n\n\n:::\n\n```{.r .cell-code}\n# Step 6: Conduct ANOVA\ncat(\"\\n=== ANOVA Results ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=== ANOVA Results ===\n```\n\n\n:::\n\n```{.r .cell-code}\nanova_model <- aov(pain_reduction ~ treatment, data = pain_data)\nanova_summary <- summary(anova_model)\nprint(anova_summary)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            Df Sum Sq Mean Sq F value Pr(>F)  \ntreatment    2  12.87   6.434    4.63 0.0137 *\nResiduals   57  79.21   1.390                 \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\n# Extract key values\nf_value <- anova_summary[[1]]$`F value`[1]\np_value <- anova_summary[[1]]$`Pr(>F)`[1]\n\ncat(\"\\nF-statistic:\", round(f_value, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nF-statistic: 4.63 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"P-value:\", format.pval(p_value, digits = 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nP-value: 0.0137 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Step 7: Check model diagnostics\ncat(\"\\n=== Model Diagnostics ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=== Model Diagnostics ===\n```\n\n\n:::\n\n```{.r .cell-code}\npar(mfrow = c(2, 2))\nplot(anova_model)\n```\n\n::: {.cell-output-display}\n![](introduction-to-anova_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n\n```{.r .cell-code}\npar(mfrow = c(1, 1))\n\n# Step 8: Post-hoc tests (if ANOVA is significant)\nif (p_value < 0.05) {\n    cat(\"\\n=== Post-hoc Analysis (Tukey HSD) ===\\n\")\n    tukey_results <- TukeyHSD(anova_model)\n    print(tukey_results)\n\n    # Plot Tukey results\n    plot(tukey_results, las = 1)\n\n    cat(\"\\n=== Pairwise Comparisons (Bonferroni) ===\\n\")\n    pairwise_results <- pairwise.t.test(pain_data$pain_reduction,\n        pain_data$treatment,\n        p.adjust.method = \"bonferroni\"\n    )\n    print(pairwise_results)\n} else {\n    cat(\"\\nANOVA not significant (p >= 0.05). Post-hoc tests not needed.\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=== Post-hoc Analysis (Tukey HSD) ===\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = pain_reduction ~ treatment, data = pain_data)\n\n$treatment\n                                  diff       lwr        upr     p adj\nPhysical Therapy-Medication -0.2859827 -1.183023  0.6110579 0.7245124\nStandard-Medication         -1.0936565 -1.990697 -0.1966160 0.0131634\nStandard-Physical Therapy   -0.8076739 -1.704714  0.0893667 0.0857513\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](introduction-to-anova_files/figure-html/unnamed-chunk-7-3.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=== Pairwise Comparisons (Bonferroni) ===\n\n\tPairwise comparisons using t tests with pooled SD \n\ndata:  pain_data$pain_reduction and pain_data$treatment \n\n                 Medication Physical Therapy\nPhysical Therapy 1.000      -               \nStandard         0.014      0.103           \n\nP value adjustment method: bonferroni \n```\n\n\n:::\n\n```{.r .cell-code}\n# Step 9: Effect size (eta-squared)\nss_between <- anova_summary[[1]]$`Sum Sq`[1]\nss_total <- sum(anova_summary[[1]]$`Sum Sq`)\neta_squared <- ss_between / ss_total\n\ncat(\"\\n=== Effect Size ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=== Effect Size ===\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Eta-squared:\", round(eta_squared, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEta-squared: 0.14 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\n    \"Interpretation: \",\n    ifelse(eta_squared < 0.01, \"negligible\",\n        ifelse(eta_squared < 0.06, \"small\",\n            ifelse(eta_squared < 0.14, \"medium\", \"large\")\n        )\n    ), \"\\n\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nInterpretation:  medium \n```\n\n\n:::\n\n```{.r .cell-code}\n# Step 10: Report results\ncat(\"\\n=== Summary for Reporting ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=== Summary for Reporting ===\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"A one-way ANOVA was conducted to compare pain reduction across three treatment groups.\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nA one-way ANOVA was conducted to compare pain reduction across three treatment groups.\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\n    \"The ANOVA was\", ifelse(p_value < 0.05, \"significant\", \"not significant\"),\n    sprintf(\n        \"F(%d, %d) = %.2f, p %s.\\n\",\n        anova_summary[[1]]$Df[1],\n        anova_summary[[1]]$Df[2],\n        f_value,\n        ifelse(p_value < 0.001, \"< .001\", paste(\"=\", round(p_value, 3)))\n    )\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nThe ANOVA was significant F(2, 57) = 4.63, p = 0.014.\n```\n\n\n:::\n\n```{.r .cell-code}\nif (p_value < 0.05) {\n    cat(\"Post-hoc comparisons using Tukey HSD indicated significant differences between groups.\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPost-hoc comparisons using Tukey HSD indicated significant differences between groups.\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"\\n=== Analysis Complete ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=== Analysis Complete ===\n```\n\n\n:::\n:::\n\n\n## Key Takeaways\n\nâœ… ANOVA tests if means differ across 3+ groups  \nâœ… Check assumptions before running ANOVA (normality, homogeneity of variance)  \nâœ… Use `aov()` function in R with formula notation `outcome ~ group`  \nâœ… If significant, conduct post-hoc tests to identify which groups differ  \nâœ… Tukey HSD controls for multiple comparisons  \nâœ… Always visualize your data with boxplots before and after analysis  \nâœ… Report F-statistic, degrees of freedom, and p-value  \n\n> **ðŸ’¡ R Tip**: Save your ANOVA model as an object (`model <- aov(...)`). You can then use this object for post-hoc tests, diagnostic plots, and extracting results without re-running the analysis!\n",
    "supporting": [
      "introduction-to-anova_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}